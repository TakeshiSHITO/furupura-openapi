components:
  schemas:
    PaymentMethod:
      type: object
      required:
        - id
        - user_id
        - type
        - is_default
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: 支払い方法ID
        user_id:
          type: string
          format: uuid
          description: ユーザーID
        type:
          type: string
          enum:
            - credit_card
            - debit_card
            - bank_transfer
            - e_wallet
            - cod
            - convenience_store
          description: 支払い方法種別
        nickname:
          type: string
          maxLength: 50
          description: 支払い方法のニックネーム
        is_default:
          type: boolean
          default: false
          description: デフォルト支払い方法フラグ
        is_active:
          type: boolean
          default: true
          description: 有効フラグ
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CreditCardInfo:
      type: object
      required:
        - payment_method_id
        - last4
        - brand
        - exp_month
        - exp_year
      properties:
        payment_method_id:
          type: string
          format: uuid
        last4:
          type: string
          pattern: '^\d{4}$'
          description: カード番号下4桁
        brand:
          type: string
          enum:
            - visa
            - mastercard
            - jcb
            - amex
            - diners
            - discover
          description: カードブランド
        exp_month:
          type: integer
          minimum: 1
          maximum: 12
          description: 有効期限（月）
        exp_year:
          type: integer
          minimum: 2024
          maximum: 2099
          description: 有効期限（年）
        holder_name:
          type: string
          description: カード名義人

    BankAccountInfo:
      type: object
      required:
        - payment_method_id
        - bank_name
        - branch_name
        - account_type
        - account_last4
      properties:
        payment_method_id:
          type: string
          format: uuid
        bank_name:
          type: string
          description: 銀行名
        bank_code:
          type: string
          pattern: '^\d{4}$'
          description: 銀行コード
        branch_name:
          type: string
          description: 支店名
        branch_code:
          type: string
          pattern: '^\d{3}$'
          description: 支店コード
        account_type:
          type: string
          enum:
            - ordinary
            - checking
            - savings
          description: 口座種別
        account_last4:
          type: string
          pattern: '^\d{4}$'
          description: 口座番号下4桁
        account_holder_name:
          type: string
          description: 口座名義人

    EWalletInfo:
      type: object
      required:
        - payment_method_id
        - provider
      properties:
        payment_method_id:
          type: string
          format: uuid
        provider:
          type: string
          enum:
            - paypay
            - line_pay
            - merpay
            - rakuten_pay
            - d_barai
            - au_pay
          description: 電子マネープロバイダー
        account_id:
          type: string
          description: アカウントID（マスク済み）
        linked_phone:
          type: string
          description: 紐付け電話番号（マスク済み）

    AddPaymentMethodRequest:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          enum:
            - credit_card
            - debit_card
            - bank_transfer
            - e_wallet
            - cod
            - convenience_store
        nickname:
          type: string
          maxLength: 50
        is_default:
          type: boolean
          default: false
        card_token:
          type: string
          description: カード情報トークン（カード決済の場合）
        bank_info:
          $ref: '#/components/schemas/BankAccountInfo'
        e_wallet_info:
          $ref: '#/components/schemas/EWalletInfo'

    UpdatePaymentMethodRequest:
      type: object
      properties:
        nickname:
          type: string
          maxLength: 50
        is_default:
          type: boolean
        is_active:
          type: boolean
